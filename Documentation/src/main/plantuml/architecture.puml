@startuml architecture
!pragma layout smetana

skinparam rectangle {
    BackgroundColor<<proxy>> LightBlue
    BackgroundColor<<gameserver>> LightGreen
    BackgroundColor<<shared>> LightYellow
    BackgroundColor<<docker>> LightGray
}

skinparam cloud {
    BackgroundColor LightSkyBlue
}

title Nerds @ ATX Minecraft Network - High-Level Architecture

' External entities
actor "Players" as players

' AWS Infrastructure Layer
cloud "AWS Cloud" {
    rectangle "VPC: minecraft-vpc" {
        package "ECS Fargate Cluster" as ecs {
            node "BungeeCord Task" as proxy_task {
                component "Proxy Container"
            }
            node "Survival Task" as survival_task {
                component "Game Server"
            }
            node "SkyBlock Task" as skyblock_task {
                component "Game Server"
            }
        }

        database "S3 Bucket\n(World Backups)" as s3
    }
}

' Docker Local Development Layer
package "Local Development (Docker)" as docker {
    rectangle "BungeeCord Container" <<docker>> as bungeecord_local {
        rectangle "BungeeCord Proxy" <<proxy>> as proxy_local
        rectangle "BungeeCordServer Plugin" <<proxy>> as proxy_plugin
    }

    rectangle "Survival Container" <<docker>> as survival_local {
        rectangle "Paper Server" <<gameserver>> as survival_server
        rectangle "SurvivalPlugin" <<gameserver>> as survival_plugin
    }

    rectangle "SkyBlock Container" <<docker>> as skyblock_local {
        rectangle "Paper Server" <<gameserver>> as skyblock_server
        rectangle "SkyBlockPlugin" <<gameserver>> as skyblock_plugin
    }

    database "Docker Volumes" as volumes {
        storage "survival-data" as survival_data
        storage "skyblock-data" as skyblock_data
    }
}

' Shared Components
package "Shared Libraries" {
    rectangle "SharedCore" <<shared>> as sharedcore {
        component "Common Utilities"
        component "Database Models"
        component "Shared Logic"
    }
}

' Module Dependencies
package "Build Artifacts" {
    artifact "BungeeCordServer.jar" as bungeecord_jar
    artifact "SurvivalPlugin.jar" as survival_jar
    artifact "SkyBlockPlugin.jar" as skyblock_jar
}

' Player Connections - AWS
players -down-> proxy_task : "Connect to\nMinecraft Server\n(Port 25577)"
proxy_task -down-> survival_task : "Route to\nSurvival"
proxy_task -down-> skyblock_task : "Route to\nSkyBlock"

survival_task -down-> s3 : "Backup\nWorlds"
skyblock_task -down-> s3 : "Backup\nWorlds"

' Player Connections - Local
players -down-> proxy_local : "Connect to\nlocalhost:25577"
proxy_local -down-> survival_server : "Route to\nSurvival"
proxy_local -down-> skyblock_server : "Route to\nSkyBlock"

' Plugin Dependencies
proxy_plugin ..> sharedcore : "depends on"
survival_plugin ..> sharedcore : "depends on"
skyblock_plugin ..> sharedcore : "depends on"

' Build Process
sharedcore -down-> bungeecord_jar : "included in"
sharedcore -down-> survival_jar : "included in"
sharedcore -down-> skyblock_jar : "included in"

bungeecord_jar -down-> bungeecord_local : "deployed to"
survival_jar -down-> survival_local : "deployed to"
skyblock_jar -down-> skyblock_local : "deployed to"

bungeecord_jar -down-> proxy_task : "deployed to"
survival_jar -down-> survival_task : "deployed to"
skyblock_jar -down-> skyblock_task : "deployed to"

' Data Persistence
survival_server -down-> survival_data : "persists\nworld data"
skyblock_server -down-> skyblock_data : "persists\nworld data"

' Docker Network
note right of bungeecord_local
  Docker Network: minecraft-network
  DNS: Services resolve by name
  - bungeecord
  - survival
  - skyblock
end note

note right of ecs
  Production Deployment
  - Auto-scaling
  - Load balancing
  - CloudWatch monitoring
  - IAM roles for S3 access
end note

note bottom of sharedcore
  Shared Across All Plugins
  - Database utilities
  - Common models
  - Shared business logic
  - Shaded into each JAR
end note

@enduml
